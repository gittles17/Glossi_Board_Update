<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>PR - Glossi</title>
  <meta name="theme-color" content="#0a0d12">
  <meta name="description" content="Glossi Board Update Dashboard - AI-powered investor communications and content strategy platform">
  <meta property="og:title" content="Glossi - Board Update Dashboard">
  <meta property="og:description" content="AI-powered investor communications and content strategy platform">
  <meta property="og:type" content="website">
  <link rel="icon" type="image/svg+xml" href="Asset 3.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Instrument+Sans:wght@400;500;600;700&display=swap" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/light/style.css">
  <link rel="stylesheet" href="dashboard.css">
</head>
<body class="pr-page">
  <h1 class="sr-only">Glossi PR Content Studio</h1>
  <!-- Top Navigation -->
  <header class="top-nav">
    <div class="nav-left">
      <a href="index.html" title="Dashboard" class="nav-logo-link">
        <img src="assets/glossi-logo.svg" alt="" class="nav-logo-icon">
        <img src="assets/glossi-wordmark.svg" alt="Glossi" class="logo-img">
      </a>
    </div>
    <div class="nav-right">
      <nav class="nav-links">
        <a href="index.html" class="nav-link">Dashboard</a>
        <a href="notebook.html" class="nav-link">Notebook</a>
        <a href="pr.html" class="nav-link nav-link-active">PR</a>
      </nav>
      <button class="nav-settings-icon" id="nav-settings-btn" title="Settings">
        <i class="ph-light ph-gear"></i>
      </button>
      <div class="dropdown-wrapper nav-mobile-menu">
        <button class="btn-icon" id="menu-btn" title="Menu" aria-label="Menu">
          <i class="ph-light ph-list"></i>
        </button>
        <div class="dropdown-menu" id="dropdown-menu">
          <a href="index.html" class="dropdown-item">
            <i class="ph-light ph-house"></i>
            Dashboard
          </a>
          <a href="notebook.html" class="dropdown-item">
            <i class="ph-light ph-book-open"></i>
            Notebook
          </a>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item" id="menu-settings">
            <i class="ph-light ph-gear"></i>
            Settings
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main PR Layout -->
  <main class="pr-main">
    <!-- Vertical Nav Rail -->
    <nav class="pr-nav-rail" id="pr-nav-rail">
      <div class="pr-nav-stages">
        <button class="pr-nav-item active" data-stage="strategy" title="Strategy" aria-label="Strategy">
          <i class="ph-light ph-crosshair"></i>
        </button>
        <button class="pr-nav-item" data-stage="create" title="Create" aria-label="Create">
          <i class="ph-light ph-pencil-simple"></i>
        </button>
        <button class="pr-nav-item" data-stage="distribute" title="Distribute" aria-label="Distribute">
          <i class="ph-light ph-share-network"></i>
        </button>
      </div>
      <button class="pr-nav-item pr-nav-sources" id="pr-nav-sources-btn" title="Sources" aria-label="Sources">
        <i class="ph-light ph-folder"></i>
        <span class="pr-nav-badge" id="pr-nav-sources-badge"></span>
      </button>
    </nav>

    <div class="pr-layout">
      <!-- Sources Drawer (global overlay, accessible from any stage) -->
      <div class="pr-sources-drawer" id="pr-sources-drawer">
        <div class="pr-sources-drawer-inner">
          <div class="pr-workflow-section pr-sources-section">
            <div class="pr-workflow-header pr-sources-header">
              <h2 class="pr-workflow-title pr-sources-label">Sources</h2>
              <span class="pr-sources-count" id="pr-sources-count">0</span>
              <button class="pr-create-folder-btn" id="pr-create-folder-btn" title="Create Folder" aria-label="Create Folder">
                <i class="ph-light ph-plus"></i>
              </button>
              <button class="pr-sources-drawer-close" id="pr-sources-drawer-close" title="Close" aria-label="Close">
                <i class="ph-light ph-x"></i>
              </button>
            </div>
            <div class="pr-source-search-wrap">
              <input type="text" class="pr-source-search" id="pr-source-search" placeholder="Search sources...">
            </div>
            <div class="pr-sources-list pr-drop-zone" id="pr-sources-list">
              <div class="pr-sources-empty" id="pr-sources-empty">
                <p>No sources yet</p>
              </div>
            </div>
            <button class="pr-add-source-btn" id="pr-add-source-btn">
              <i class="ph-light ph-plus"></i>
              <span>Add Source</span>
            </button>
          </div>
        </div>
      </div>
      <div class="pr-sources-backdrop" id="pr-sources-backdrop"></div>

      <!-- Strategy Stage Content -->
      <div class="pr-sources-panel pr-stage-content active" id="pr-sources-panel" data-stage="strategy">

        <!-- Full-Width News Hooks -->
        <div class="pr-strategy-layout">
          <div class="pr-workflow-section pr-news-hooks-section">
            <div class="pr-workflow-header pr-news-hooks-toolbar">
              <h2 class="pr-workflow-title">What's Happening Now</h2>
              <div class="pr-news-hooks-controls">
                <div class="pr-search-expandable-wrap">
                  <button class="pr-toolbar-btn" id="pr-search-toggle" title="Search articles" aria-label="Search articles">
                    <i class="ph-light ph-magnifying-glass"></i>
                  </button>
                  <div class="pr-search-expandable" id="pr-search-expandable" style="display:none">
                    <input type="text" class="pr-news-search" id="pr-news-search" placeholder="Search articles..." autocomplete="off">
                    <button class="pr-news-search-clear" id="pr-news-search-clear" style="display:none" title="Clear search" aria-label="Clear search">&times;</button>
                  </div>
                </div>
                <div class="pr-add-url-wrap-outer">
                  <button class="pr-toolbar-btn" id="pr-add-url-btn" title="Add article by URL" aria-label="Add article by URL">
                    <i class="ph-light ph-plus"></i>
                  </button>
                  <div class="pr-add-url-input-wrap" id="pr-add-url-input-wrap" style="display:none">
                    <input type="url" class="pr-add-url-input" id="pr-add-url-input" placeholder="Paste article URL..." autocomplete="off">
                    <button class="pr-add-url-submit" id="pr-add-url-submit" title="Analyze" aria-label="Analyze">
                      <i class="ph-light ph-paper-plane-tilt"></i>
                    </button>
                    <button class="pr-add-url-cancel" id="pr-add-url-cancel" title="Cancel" aria-label="Cancel">&times;</button>
                  </div>
                </div>
                <div class="pr-filter-wrap">
                  <button class="pr-toolbar-btn" id="pr-filter-toggle" title="Filters" aria-label="Filters">
                    <i class="ph-light ph-funnel"></i>
                    <span class="pr-filter-active-dot" id="pr-filter-active-dot" style="display:none"></span>
                  </button>
                  <div class="pr-filter-dropdown" id="pr-filter-dropdown" style="display:none">
                    <div class="pr-filter-dropdown-section">
                      <span class="pr-filter-dropdown-label">Date range</span>
                      <label class="pr-filter-radio"><input type="radio" name="pr-date-range" value="7"> Last 7 days</label>
                      <label class="pr-filter-radio"><input type="radio" name="pr-date-range" value="30"> Last 30 days</label>
                      <label class="pr-filter-radio"><input type="radio" name="pr-date-range" value="60" checked> Last 60 days</label>
                      <label class="pr-filter-radio"><input type="radio" name="pr-date-range" value="all"> All time</label>
                    </div>
                    <div class="pr-filter-dropdown-divider"></div>
                    <div class="pr-filter-dropdown-section">
                      <span class="pr-filter-dropdown-label">Outlets</span>
                      <div class="pr-filter-outlet-list" id="pr-filter-outlet-list"></div>
                    </div>
                    <div class="pr-filter-dropdown-divider"></div>
                    <button class="pr-filter-dropdown-clear" id="pr-filter-clear-all">Clear all filters</button>
                  </div>
                </div>
                <button class="pr-toolbar-btn" id="pr-fetch-news-btn" title="Refresh" aria-label="Refresh">
                  <i class="ph-light ph-arrows-clockwise"></i>
                </button>
              </div>
            </div>
            <div class="pr-news-hooks-list" id="pr-news-hooks-list">
              <div class="pr-news-hooks-empty">No news hooks yet</div>
            </div>
          </div>
        </div>

      </div>

      <!-- Resizer between left and center -->
      <div class="pr-resizer" id="pr-resizer-left" data-resize="left"></div>

      <!-- Create Stage Content -->
      <div class="pr-workspace-panel pr-stage-content" id="pr-workspace-panel" data-stage="create">
        
        <!-- 2-Panel Create Layout -->
        <div class="pr-create-layout">
          
          <!-- Left Panel: File Tree -->
          <div class="pr-create-left" id="pr-create-left">

            <!-- Toggle collapse/expand -->
            <div class="pr-panel-toggle-wrap">
              <button class="pr-panel-toggle" id="pr-panel-toggle" title="Toggle panel" aria-label="Toggle panel">
                <i class="ph-light ph-sidebar-simple"></i>
              </button>
            </div>

            <div class="pr-panel-label-row">
              <span class="pr-panel-label">Articles</span>
              <button class="pr-file-tree-select-toggle" id="pr-select-toggle" title="Select articles">
                <i class="ph-light ph-check-square"></i>
              </button>
            </div>

            <!-- File Tree -->
            <div class="pr-file-tree" id="pr-file-tree">
              <div class="pr-file-tree-empty">
                <p>Click "Create Content" on a news card to get started.</p>
              </div>
            </div>

            <!-- Legacy: hidden elements for backward compat -->
            <div style="display:none">
              <div id="pr-angles-list"></div>
              <div id="pr-content-list"></div>
              <div id="pr-content-empty"></div>
              <button id="pr-generate-angles-btn"></button>
              <div id="pr-angle-context"></div>
              <div id="pr-source-ref-section"><div id="pr-source-ref"></div></div>
              <div id="pr-version-section"><div id="pr-version-list"></div></div>
            </div>
          </div>

          <!-- Resize divider -->
          <div class="pr-panel-divider" id="pr-panel-divider"></div>

          <!-- Right Panel (2/3): Workspace -->
          <div class="pr-create-right">

            <!-- Content Plan Tabs + Actions -->
            <div class="pr-content-tabs" id="pr-content-tabs" style="display:none">
              <!-- tabs are rendered dynamically -->
              <div class="pr-workspace-actions" style="display:none" id="pr-workspace-actions">
                <div class="pr-version-pill-wrap">
                  <button class="pr-version-pill" id="pr-version-pill" title="Version history" aria-label="Version history">
                    <span id="pr-version-pill-label">Latest</span>
                    <i class="ph-light ph-caret-down"></i>
                  </button>
                  <div class="pr-version-menu" id="pr-version-menu" style="display:none"></div>
                </div>
                <button class="pr-action-btn" id="pr-tone-btn" title="Tone" aria-label="Tone">
                  <i class="ph-light ph-megaphone-simple"></i>
                </button>
                <button class="pr-action-btn" id="pr-copy-btn" title="Copy to clipboard" aria-label="Copy to clipboard">
                  <i class="ph-light ph-copy"></i>
                </button>
                <div class="pr-export-wrap">
                  <button class="pr-action-btn" id="pr-export-btn" title="Export" aria-label="Export">
                    <i class="ph-light ph-download-simple"></i>
                  </button>
                  <div class="pr-export-menu" id="pr-export-menu">
                    <button class="pr-export-item" id="pr-export-text">Copy as text</button>
                    <button class="pr-export-item" id="pr-export-html">Download as HTML</button>
                  </div>
                </div>
                <div class="pr-action-divider"></div>
                <button class="pr-send-to-review-btn" id="pr-send-to-review-btn" title="Send to Distribute for review and publishing">
                  <i class="ph-light ph-share-network"></i>
                  Send to Review
                </button>
              </div>
            </div>

            <!-- Top bar (generate controls) -->
            <div class="pr-workspace-topbar">
              <div class="pr-workspace-controls">
                <select class="pr-content-type" id="pr-content-type" style="display:none">
                  <option value="press_release">Press Release</option>
                  <option value="media_pitch">Media Pitch Email</option>
                  <option value="product_announcement">Product Announcement</option>
                  <option value="founder_quote">Founder Quote / Soundbite</option>
                  <option value="blog_post">Blog Post</option>
                  <option value="linkedin_post">LinkedIn Post</option>
                  <option value="tweet_thread">Tweet Thread</option>
                  <option value="briefing_doc">Briefing Document</option>
                  <option value="talking_points">Talking Points</option>
                  <option value="op_ed">Op-Ed / Bylined Article</option>
                  <option value="email_blast">Email Blast</option>
                  <option value="investor_snippet">Investor Update Snippet</option>
                  <option value="hot_take">Hot Take</option>
                  <option value="custom">Custom</option>
                </select>
                <button class="pr-generate-btn" id="pr-generate-btn" disabled style="display:none">
                  <i class="ph-light ph-lightning"></i>
                  Generate
                </button>
                <button class="pr-regenerate-btn" id="pr-regenerate-btn" style="display:none">
                  <i class="ph-light ph-arrows-clockwise"></i>
                  Regenerate
                </button>
              </div>
            </div>

            <!-- Status hint -->
            <div class="pr-status-hint" id="pr-status-hint" style="display:none">
              <i class="ph-light ph-info"></i>
              <span id="pr-status-hint-text"></span>
            </div>

            <!-- Custom prompt -->
            <div class="pr-custom-prompt-wrap" id="pr-custom-prompt-wrap" style="display:none">
              <textarea class="pr-custom-prompt" id="pr-custom-prompt" placeholder="Describe what you want to generate..." rows="2"></textarea>
            </div>

            <!-- Content area -->
            <div class="pr-workspace-content" id="pr-workspace-content">
              <!-- Empty state -->
              <div class="pr-workspace-empty" id="pr-workspace-empty">
                <div class="pr-empty-message">
                  <i class="ph-light ph-file-text" style="font-size: 48px; opacity: 0.3;"></i>
                  <p>Click "Create Content" on a news card to start generating.</p>
                </div>
              </div>

              <!-- Loading state -->
              <div class="pr-loading-state" id="pr-loading-state" style="display:none">
                <div class="glossi-loader glossi-loader-sm">
                  <svg class="glossi-loader-dots" viewBox="0 0 100 100"><line x1="90.0" y1="50.0" x2="98.0" y2="50.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-0"/><line x1="88.6" y1="60.4" x2="96.4" y2="62.4" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-1"/><line x1="84.6" y1="70.0" x2="91.6" y2="74.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-2"/><line x1="78.3" y1="78.3" x2="83.9" y2="83.9" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-3"/><line x1="70.0" y1="84.6" x2="74.0" y2="91.6" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-4"/><line x1="60.4" y1="88.6" x2="62.4" y2="96.4" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-5"/><line x1="50.0" y1="90.0" x2="50.0" y2="98.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-6"/><line x1="39.6" y1="88.6" x2="37.6" y2="96.4" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-7"/><line x1="30.0" y1="84.6" x2="26.0" y2="91.6" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-8"/><line x1="21.7" y1="78.3" x2="16.1" y2="83.9" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-9"/><line x1="15.4" y1="70.0" x2="8.4" y2="74.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-10"/><line x1="11.4" y1="60.4" x2="3.6" y2="62.4" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-11"/><line x1="10.0" y1="50.0" x2="2.0" y2="50.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-12"/><line x1="11.4" y1="39.6" x2="3.6" y2="37.6" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-13"/><line x1="15.4" y1="30.0" x2="8.4" y2="26.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-14"/><line x1="21.7" y1="21.7" x2="16.1" y2="16.1" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-15"/><line x1="30.0" y1="15.4" x2="26.0" y2="8.4" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-16"/><line x1="39.6" y1="11.4" x2="37.6" y2="3.6" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-17"/><line x1="50.0" y1="10.0" x2="50.0" y2="2.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-18"/><line x1="60.4" y1="11.4" x2="62.4" y2="3.6" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-19"/><line x1="70.0" y1="15.4" x2="74.0" y2="8.4" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-20"/><line x1="78.3" y1="21.7" x2="83.9" y2="16.1" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-21"/><line x1="84.6" y1="30.0" x2="91.6" y2="26.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-22"/><line x1="88.6" y1="39.6" x2="96.4" y2="37.6" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-23"/></svg>
                </div>
              </div>

              <!-- Generated content (inline editable) -->
              <div class="pr-workspace-generated" id="pr-workspace-generated" style="display:none">
                <div class="pr-generated-content" id="pr-generated-content" contenteditable="true" spellcheck="true"></div>
                <div class="pr-suggestions" id="pr-suggestions"></div>
              </div>

              <!-- Refining overlay (covers full workspace area) -->
              <div class="pr-refining-overlay" id="pr-refining-overlay" style="display:none">
                <div class="pr-refining-content">
                  <div class="glossi-loader glossi-loader-sm">
                    <svg class="glossi-loader-dots" viewBox="0 0 100 100"><line x1="90.0" y1="50.0" x2="98.0" y2="50.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-0"/><line x1="88.6" y1="60.4" x2="96.4" y2="62.4" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-1"/><line x1="84.6" y1="70.0" x2="91.6" y2="74.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-2"/><line x1="78.3" y1="78.3" x2="83.9" y2="83.9" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-3"/><line x1="70.0" y1="84.6" x2="74.0" y2="91.6" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-4"/><line x1="60.4" y1="88.6" x2="62.4" y2="96.4" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-5"/><line x1="50.0" y1="90.0" x2="50.0" y2="98.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-6"/><line x1="39.6" y1="88.6" x2="37.6" y2="96.4" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-7"/><line x1="30.0" y1="84.6" x2="26.0" y2="91.6" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-8"/><line x1="21.7" y1="78.3" x2="16.1" y2="83.9" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-9"/><line x1="15.4" y1="70.0" x2="8.4" y2="74.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-10"/><line x1="11.4" y1="60.4" x2="3.6" y2="62.4" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-11"/><line x1="10.0" y1="50.0" x2="2.0" y2="50.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-12"/><line x1="11.4" y1="39.6" x2="3.6" y2="37.6" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-13"/><line x1="15.4" y1="30.0" x2="8.4" y2="26.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-14"/><line x1="21.7" y1="21.7" x2="16.1" y2="16.1" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-15"/><line x1="30.0" y1="15.4" x2="26.0" y2="8.4" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-16"/><line x1="39.6" y1="11.4" x2="37.6" y2="3.6" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-17"/><line x1="50.0" y1="10.0" x2="50.0" y2="2.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-18"/><line x1="60.4" y1="11.4" x2="62.4" y2="3.6" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-19"/><line x1="70.0" y1="15.4" x2="74.0" y2="8.4" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-20"/><line x1="78.3" y1="21.7" x2="83.9" y2="16.1" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-21"/><line x1="84.6" y1="30.0" x2="91.6" y2="26.0" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-22"/><line x1="88.6" y1="39.6" x2="96.4" y2="37.6" stroke="#fff" stroke-width="1" stroke-linecap="round" class="gl-tick gl-tick-23"/></svg>
                  </div>
                </div>
              </div>
            </div>

            <!-- Compact chat input (sticky bottom) -->
            <div class="pr-workspace-chat" id="pr-workspace-chat" style="display:none">
              <input type="text" id="pr-chat-input" class="pr-workspace-chat-input" placeholder="Refine further..." autocomplete="off" />
              <button class="pr-workspace-chat-send" id="pr-send-btn" title="Send" aria-label="Send">
                <i class="ph-light ph-paper-plane-tilt"></i>
              </button>
            </div>

          </div>
        </div>

      </div>

      <!-- Resizer between center and right -->
      <div class="pr-resizer" id="pr-resizer-right" data-resize="right"></div>

      <!-- Distribute Stage Content -->
      <div class="pr-stage-content" id="pr-distribute-stage" data-stage="distribute">
        <div class="pr-distribute-layout">

          <!-- Left: Review Queue -->
          <div class="pr-distribute-queue" id="pr-distribute-queue">
            <div class="pr-distribute-queue-header">
              <span class="pr-panel-label">Distribute</span>
              <button class="pr-distribute-settings-btn" id="pr-distribute-settings-btn" title="Channel Settings" aria-label="Channel Settings">
                <i class="ph-light ph-gear"></i>
              </button>
            </div>

            <div class="pr-distribute-section">
              <div class="pr-distribute-section-label">In Review</div>
              <div class="pr-distribute-queue-list" id="pr-distribute-review-list">
                <div class="pr-distribute-queue-empty">No items in review</div>
              </div>
            </div>

            <div class="pr-distribute-section">
              <div class="pr-distribute-section-label">Scheduled</div>
              <div class="pr-distribute-queue-list" id="pr-distribute-scheduled-list">
                <div class="pr-distribute-queue-empty">No scheduled posts</div>
              </div>
            </div>

            <div class="pr-distribute-section">
              <div class="pr-distribute-section-label pr-distribute-published-toggle" id="pr-distribute-published-toggle">
                <i class="ph-light ph-caret-right pr-distribute-toggle-icon"></i>
                Published
                <span class="pr-distribute-count-badge" id="pr-distribute-published-count">0</span>
              </div>
              <div class="pr-distribute-queue-list" id="pr-distribute-published-list" style="display:none">
              </div>
            </div>
          </div>

          <!-- Right: Preview + Actions -->
          <div class="pr-distribute-preview-area" id="pr-distribute-preview-area">

            <!-- Empty state -->
            <div class="pr-distribute-empty-state" id="pr-distribute-empty-state">
              <div class="pr-empty-message">
                <i class="ph-light ph-share-network" style="font-size: 48px; opacity: 0.3;"></i>
                <p>Send content to review from the Create tab to preview and publish.</p>
              </div>
            </div>

            <!-- Preview content (hidden by default) -->
            <div class="pr-distribute-preview-content" id="pr-distribute-preview-content" style="display:none">

              <!-- Channel selector -->
              <div class="pr-distribute-channel-bar">
                <span class="pr-distribute-channel-label">Preview as:</span>
                <button class="pr-distribute-channel-btn active" data-channel="linkedin">
                  <i class="ph-light ph-linkedin-logo"></i> LinkedIn
                </button>
              </div>

              <!-- LinkedIn Preview Card -->
              <div class="pr-linkedin-preview-wrap">
                <div class="pr-linkedin-preview" id="pr-linkedin-preview"></div>
              </div>

              <!-- Character count -->
              <div class="pr-distribute-char-count" id="pr-distribute-char-count"></div>

              <!-- Action bar -->
              <div class="pr-distribute-actions">
                <button class="pr-distribute-back-btn" id="pr-distribute-back-btn">
                  <i class="ph-light ph-arrow-left"></i>
                  Back to Edit
                </button>
                <div class="pr-distribute-publish-group">
                  <button class="pr-distribute-schedule-btn" id="pr-distribute-schedule-btn">
                    <i class="ph-light ph-clock"></i>
                    Schedule
                  </button>
                  <button class="pr-distribute-publish-btn" id="pr-distribute-publish-btn">
                    <i class="ph-light ph-paper-plane-tilt"></i>
                    Publish Now
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Settings Panel (overlay) -->
          <div class="pr-distribute-settings-panel" id="pr-distribute-settings-panel" style="display:none">
            <div class="pr-distribute-settings-header">
              <h3>Channel Settings</h3>
              <button class="pr-distribute-settings-close" id="pr-distribute-settings-close" title="Close" aria-label="Close">
                <i class="ph-light ph-x"></i>
              </button>
            </div>
            <div class="pr-distribute-settings-body">
              <div class="pr-distribute-settings-section">
                <h4>LinkedIn Profile</h4>
                <p class="pr-distribute-settings-hint">This info is used for the LinkedIn post preview mockup.</p>
                <div class="pr-distribute-field">
                  <label for="pr-linkedin-name">Display Name</label>
                  <input type="text" id="pr-linkedin-name" class="input" placeholder="e.g., Jonathan Gitlin">
                </div>
                <div class="pr-distribute-field">
                  <label for="pr-linkedin-headline">Headline</label>
                  <input type="text" id="pr-linkedin-headline" class="input" placeholder="e.g., CEO & Co-Founder at Glossi">
                </div>
                <div class="pr-distribute-field">
                  <label for="pr-linkedin-photo">Profile Photo URL</label>
                  <input type="url" id="pr-linkedin-photo" class="input" placeholder="https://...">
                  <div class="pr-linkedin-photo-preview" id="pr-linkedin-photo-preview"></div>
                </div>
              </div>
            </div>
            <div class="pr-distribute-settings-footer">
              <button class="btn btn-primary" id="pr-distribute-settings-save">Save Settings</button>
            </div>
          </div>

        </div>
      </div>
    </div>
  </main>

  <!-- Add Source Modal -->
  <div class="modal-overlay" id="pr-source-modal">
    <div class="modal modal-large">
      <div class="modal-header">
        <h2>Add Source</h2>
        <button class="btn-icon modal-close" id="pr-source-modal-close" title="Close" aria-label="Close">
          <i class="ph-light ph-x"></i>
        </button>
      </div>
      <div class="modal-body">
        <!-- Source Type Tabs -->
        <div class="pr-source-tabs">
          <button class="pr-source-tab active" data-type="text">
            <i class="ph-light ph-file-text"></i>
            Paste Text
          </button>
          <button class="pr-source-tab" data-type="url">
            <i class="ph-light ph-link"></i>
            URL
          </button>
          <button class="pr-source-tab" data-type="file">
            <i class="ph-light ph-file-text"></i>
            Upload File
          </button>
          <button class="pr-source-tab" data-type="audio">
            <i class="ph-light ph-microphone"></i>
            Audio
          </button>
        </div>

        <!-- Paste Text Panel -->
        <div class="pr-source-panel active" id="pr-panel-text">
          <div class="notes-input-section">
            <label for="pr-source-title">Title (optional)</label>
            <input type="text" id="pr-source-title" class="input" placeholder="e.g., Q1 Product Update">
          </div>
          <div class="notes-input-section">
            <label for="pr-source-text">Content</label>
            <textarea id="pr-source-text" class="input textarea" rows="10" placeholder="Paste your text content here..."></textarea>
          </div>
        </div>

        <!-- URL Panel -->
        <div class="pr-source-panel" id="pr-panel-url">
          <div class="notes-input-section">
            <label for="pr-source-title-url">Title (optional)</label>
            <input type="text" id="pr-source-title-url" class="input" placeholder="e.g., TechCrunch Article">
          </div>
          <div class="notes-input-section">
            <label for="pr-source-url">URL</label>
            <input type="url" id="pr-source-url" class="input" placeholder="https://...">
            <p class="input-hint">Content will be fetched and extracted automatically</p>
          </div>
        </div>

        <!-- File Upload Panel -->
        <div class="pr-source-panel" id="pr-panel-file">
          <div class="notes-input-section">
            <label for="pr-source-title-file">Title (optional)</label>
            <input type="text" id="pr-source-title-file" class="input" placeholder="e.g., Press Kit PDF">
          </div>
          <div class="pr-file-dropzone" id="pr-file-dropzone">
            <input type="file" id="pr-source-file-input" accept=".txt,.md,.csv,.pdf" style="display:none">
            <i class="ph-light ph-upload-simple" style="font-size: 32px;"></i>
            <span>Drop file here or click to browse</span>
            <span class="pr-dropzone-hint">PDF, TXT, MD, CSV (max 10MB)</span>
          </div>
          <div class="pr-file-preview" id="pr-file-preview" style="display:none"></div>
        </div>

        <!-- Audio Panel -->
        <div class="pr-source-panel" id="pr-panel-audio">
          <div class="notes-input-section">
            <label for="pr-source-title-audio">Title (optional)</label>
            <input type="text" id="pr-source-title-audio" class="input" placeholder="e.g., Founder Interview">
          </div>
          <div class="pr-audio-controls">
            <button class="btn btn-secondary" id="pr-audio-record">
              <i class="ph-light ph-record"></i>
              Record
            </button>
            <button class="btn btn-danger" id="pr-audio-stop" style="display:none">
              <i class="ph-light ph-stop"></i>
              Stop
            </button>
            <span class="pr-audio-divider">or</span>
            <button class="btn btn-secondary" id="pr-audio-upload-btn">Upload Audio</button>
            <input type="file" id="pr-audio-file-input" accept=".mp3,.wav,.m4a,.webm" style="display:none">
          </div>
          <div class="pr-audio-indicator" id="pr-audio-indicator" style="display:none">
            <span class="pr-recording-dot"></span>
            <span>Recording...</span>
          </div>
          <div class="pr-audio-preview" id="pr-audio-preview" style="display:none">
            <span id="pr-audio-status">Processing...</span>
          </div>
          <div class="pr-audio-transcript" id="pr-audio-transcript" style="display:none"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="pr-source-cancel">Cancel</button>
        <button class="btn btn-primary" id="pr-source-save">
          <i class="ph-light ph-plus"></i>
          Add Source
        </button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settings-modal">
    <div class="modal">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="btn-icon modal-close" id="settings-modal-close" title="Close" aria-label="Close">
          <i class="ph-light ph-x"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="settings-section">
          <h3>AI Configuration</h3>
          <p class="input-hint" style="margin-bottom: var(--space-3)">API keys are configured via environment variables in production.</p>
          <div class="pr-settings-status">
            <div class="pr-settings-row">
              <span class="pr-settings-label-text">Anthropic API</span>
              <span class="pr-settings-badge" id="pr-anthropic-status">Checking...</span>
            </div>
            <div class="pr-settings-row">
              <span class="pr-settings-label-text">OpenAI API</span>
              <span class="pr-settings-badge" id="pr-openai-status">Checking...</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="settings-cancel">Close</button>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal-overlay" id="confirm-modal">
    <div class="modal modal-confirm">
      <div class="modal-header">
        <h2 id="confirm-modal-title">Confirm</h2>
      </div>
      <div class="modal-body">
        <p id="confirm-modal-message">Are you sure?</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="confirm-modal-cancel">Cancel</button>
        <button class="btn btn-danger" id="confirm-modal-ok">OK</button>
      </div>
    </div>
  </div>

  <!-- Schedule Post Modal -->
  <div class="modal-overlay" id="pr-schedule-modal">
    <div class="modal">
      <div class="modal-header">
        <h2>Schedule Post</h2>
        <button class="btn-icon modal-close" id="pr-schedule-modal-close" title="Close" aria-label="Close">
          <i class="ph-light ph-x"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="pr-distribute-field">
          <label for="pr-schedule-date">Date</label>
          <input type="date" id="pr-schedule-date" class="input">
        </div>
        <div class="pr-distribute-field">
          <label for="pr-schedule-time">Time</label>
          <input type="time" id="pr-schedule-time" class="input" value="09:00">
        </div>
        <p class="pr-distribute-settings-hint" style="margin-top: var(--space-3)">The post will be queued for publishing at this time. Actual posting will be available once your LinkedIn account is connected.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="pr-schedule-cancel">Cancel</button>
        <button class="btn btn-primary" id="pr-schedule-confirm">
          <i class="ph-light ph-clock"></i>
          Schedule
        </button>
      </div>
    </div>
  </div>

  <!-- Wizard Modal -->
  <div class="wizard-overlay" id="wizard-overlay">
    <div class="wizard-container">
      <div class="wizard-header">
        <div class="wizard-progress">
          <span class="wizard-step-text" id="wizard-step-text">Step 1 of 6</span>
          <div class="wizard-progress-bar">
            <div class="wizard-progress-fill" id="wizard-progress-fill"></div>
          </div>
        </div>
        <button class="wizard-close" id="wizard-close" title="Save and close" aria-label="Save and close">
          <i class="ph-light ph-x"></i>
        </button>
      </div>
      
      <div class="wizard-body" id="wizard-body">
        <!-- Step 1: Company Basics -->
        <div class="wizard-step active" data-step="1">
          <h2 class="wizard-title">Tell us about your company</h2>
          <div class="wizard-field">
            <label for="wizard-company-name">Company Name</label>
            <input type="text" id="wizard-company-name" class="input" placeholder="e.g., Glossi">
          </div>
          <div class="wizard-field">
            <label for="wizard-company-description">One-line Description</label>
            <input type="text" id="wizard-company-description" class="input" placeholder="e.g., AI-native 3D product visualization platform">
          </div>
          <div class="wizard-field">
            <label for="wizard-founded-year">Founded Year</label>
            <input type="text" id="wizard-founded-year" class="input" placeholder="e.g., 2024">
          </div>
          <div class="wizard-field">
            <label for="wizard-team-size">Team Size</label>
            <input type="text" id="wizard-team-size" class="input" placeholder="e.g., 5 people">
          </div>
          <div class="wizard-field">
            <label for="wizard-headquarters">Headquarters / Location</label>
            <input type="text" id="wizard-headquarters" class="input" placeholder="e.g., San Francisco, CA">
          </div>
          <div class="wizard-field">
            <label for="wizard-website">Website URL</label>
            <input type="url" id="wizard-website" class="input" placeholder="https://glossi.io">
          </div>
          <div class="wizard-field">
            <label for="wizard-founders">Founder Name(s) and Title(s)</label>
            <input type="text" id="wizard-founders" class="input" placeholder="e.g., Jonathan Gitlin, CEO & Co-Founder">
          </div>
          <div class="wizard-field">
            <label for="wizard-founder-background">Founder Background</label>
            <textarea id="wizard-founder-background" class="input textarea" rows="3" placeholder="Previously at [company], expertise in [area]"></textarea>
            <p class="input-hint">What makes your founder(s) uniquely qualified to build this?</p>
          </div>
        </div>
        
        <!-- Step 2: The Problem -->
        <div class="wizard-step" data-step="2">
          <h2 class="wizard-title">Tell us about the problem Glossi solves</h2>
          <p class="wizard-subtitle">Be specific. Include numbers, timeframes, and pain points you've heard directly from customers.</p>
          <div class="wizard-field">
            <label for="wizard-problem">What problem does your product solve?</label>
            <textarea id="wizard-problem" class="input textarea" rows="4" placeholder="What happens when brands use AI image generators on their products?"></textarea>
            <p class="input-hint">ðŸ’¡ Example: "Colors shift, proportions drift, logos get warped. The more content you create, the worse it gets."</p>
          </div>
          <div class="wizard-field">
            <label for="wizard-who">Who experiences this problem?</label>
            <textarea id="wizard-who" class="input textarea" rows="3" placeholder="Enterprise brands, e-commerce teams, CPG marketing departments"></textarea>
          </div>
          <div class="wizard-field">
            <label for="wizard-current-solution">What do they currently do about it?</label>
            <textarea id="wizard-current-solution" class="input textarea" rows="3" placeholder="Traditional photography, 3D rendering, or AI generators that distort the product"></textarea>
          </div>
          <div class="wizard-field">
            <label for="wizard-cost">What's the cost of the current approach?</label>
            <textarea id="wizard-cost" class="input textarea" rows="3" placeholder="Weeks per shoot, $50K+ per product line, brand inconsistency at scale"></textarea>
          </div>
        </div>
        
        <!-- Step 3: The Solution -->
        <div class="wizard-step" data-step="3">
          <h2 class="wizard-title">Tell us about your solution</h2>
          <div class="wizard-field">
            <label for="wizard-solution">How does your product solve this differently?</label>
            <textarea id="wizard-solution" class="input textarea" rows="4" placeholder="What makes your approach unique?"></textarea>
          </div>
          <div class="wizard-field">
            <label for="wizard-technology">What is the core technology?</label>
            <textarea id="wizard-technology" class="input textarea" rows="3" placeholder="Real-time 3D compositing in browser, Unreal Engine 5"></textarea>
          </div>
          <div class="wizard-field">
            <label for="wizard-insight">What's the key insight or architecture decision that makes you different?</label>
            <textarea id="wizard-insight" class="input textarea" rows="3" placeholder="What do you understand that others don't?"></textarea>
          </div>
          <div class="wizard-field">
            <label for="wizard-analogy">Analogy: "Our product is like _____ for _____"</label>
            <input type="text" id="wizard-analogy" class="input" placeholder="e.g., green screen for products">
            <p class="input-hint">Help journalists understand quickly with a simple comparison</p>
          </div>
        </div>
        
        <!-- Step 4: Traction & Proof Points -->
        <div class="wizard-step" data-step="4">
          <h2 class="wizard-title">Traction & Proof Points</h2>
          <p class="wizard-subtitle">Numbers make stories real. "50+ brands" is good. "50+ brands including 3 Fortune 500 CPG companies" is better.</p>
          <div class="wizard-field">
            <label for="wizard-customers">Number of customers/brands using the product</label>
            <input type="text" id="wizard-customers" class="input" placeholder="e.g., 50+ brands">
          </div>
          <div class="wizard-field">
            <label for="wizard-revenue">Revenue or pipeline (optional, only used for PR if you choose)</label>
            <input type="text" id="wizard-revenue" class="input" placeholder="e.g., $200K pipeline">
          </div>
          <div class="wizard-field">
            <label for="wizard-key-metric">Key metric: cost/time reduction for customers</label>
            <input type="text" id="wizard-key-metric" class="input" placeholder="e.g., 80% reduction in photography costs">
          </div>
          <div class="wizard-field">
            <label for="wizard-notable-customers">Notable customer names (if shareable) or anonymized descriptions</label>
            <textarea id="wizard-notable-customers" class="input textarea" rows="2" placeholder="e.g., 3 Fortune 500 CPG companies, major fashion brands"></textarea>
          </div>
          <div class="wizard-field">
            <label for="wizard-press">Any press coverage received so far (URLs or descriptions)</label>
            <textarea id="wizard-press" class="input textarea" rows="2" placeholder="URLs or brief descriptions"></textarea>
          </div>
          <div class="wizard-field">
            <label for="wizard-awards">Awards, accelerator participation, notable investors</label>
            <textarea id="wizard-awards" class="input textarea" rows="2" placeholder="e.g., Y Combinator, Sequoia-backed"></textarea>
          </div>
          <div class="wizard-field">
            <label for="wizard-features">Features shipped in last 90 days</label>
            <textarea id="wizard-features" class="input textarea" rows="3" placeholder="List or describe recent feature launches"></textarea>
          </div>
        </div>
        
        <!-- Step 5: Why Now / Market Timing -->
        <div class="wizard-step" data-step="5">
          <h2 class="wizard-title">Why Now / Market Timing</h2>
          <div class="wizard-field">
            <label for="wizard-market-urgency">What's happening in your market right now that makes this urgent?</label>
            <textarea id="wizard-market-urgency" class="input textarea" rows="3" placeholder="What market shifts or trends create urgency?"></textarea>
          </div>
          <div class="wizard-field">
            <label for="wizard-tech-shifts">Are there any technology shifts or trends that validate your approach?</label>
            <textarea id="wizard-tech-shifts" class="input textarea" rows="3" placeholder="World models from Google and OpenAI are rolling out in 2026"></textarea>
          </div>
          <div class="wizard-field">
            <label for="wizard-moat">Why can't incumbents do what you do?</label>
            <textarea id="wizard-moat" class="input textarea" rows="3" placeholder="What makes your approach hard to replicate?"></textarea>
          </div>
          <div class="wizard-field">
            <label for="wizard-if-not">What happens if brands don't adopt your approach?</label>
            <textarea id="wizard-if-not" class="input textarea" rows="3" placeholder="What's the consequence of inaction?"></textarea>
          </div>
        </div>
        
        <!-- Step 6: Founder Voice -->
        <div class="wizard-step" data-step="6">
          <h2 class="wizard-title">Founder Voice</h2>
          <div class="wizard-field">
            <label for="wizard-elevator-pitch">If a journalist called you right now, what would you want to say in 30 seconds?</label>
            <textarea id="wizard-elevator-pitch" class="input textarea" rows="3" placeholder="Your clearest, most confident pitch"></textarea>
          </div>
          <div class="wizard-field">
            <label for="wizard-strong-opinion">What's a strong opinion you hold about your industry?</label>
            <textarea id="wizard-strong-opinion" class="input textarea" rows="3" placeholder="Most AI tools are wrappers. They don't protect the product."></textarea>
          </div>
          <div class="wizard-field">
            <label for="wizard-investor-pitch">What's the thing you say in investor meetings that always lands?</label>
            <textarea id="wizard-investor-pitch" class="input textarea" rows="3" placeholder="What resonates most with investors?"></textarea>
          </div>
        </div>
      </div>
      
      <div class="wizard-footer">
        <button class="wizard-skip" id="wizard-skip">Skip this step</button>
        <div class="wizard-nav">
          <button class="btn btn-secondary" id="wizard-back" style="display:none">Back</button>
          <button class="btn btn-primary" id="wizard-next">Next â†’</button>
          <button class="btn btn-primary" id="wizard-finish" style="display:none">
            <i class="ph-light ph-check"></i>
            Finish
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container"></div>

  <!-- PDF.js for file processing -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
  </script>

  <script type="module">
    import { PRAgent } from './modules/pr.js';

    document.addEventListener('DOMContentLoaded', async () => {
      const pr = new PRAgent();
      await pr.init();
      pr.setupFileUpload();
      pr.setupAudio();

      // Panel Resizer Class
      class PanelResizer {
        constructor() {
          this.leftResizer = document.getElementById('pr-resizer-left');
          this.rightResizer = document.getElementById('pr-resizer-right');
          this.leftPanel = document.getElementById('pr-sources-panel');
          this.rightPanel = document.getElementById('pr-distribute-stage');
          
          this.init();
          this.loadSavedWidths();
        }
        
        init() {
          if (this.leftResizer) {
            this.leftResizer.addEventListener('mousedown', (e) => this.startResize(e, 'left'));
            this.leftResizer.addEventListener('dblclick', () => this.resetWidth('left'));
          }
          
          if (this.rightResizer) {
            this.rightResizer.addEventListener('mousedown', (e) => this.startResize(e, 'right'));
            this.rightResizer.addEventListener('dblclick', () => this.resetWidth('right'));
          }
        }
        
        startResize(e, side) {
          e.preventDefault();
          
          const resizer = side === 'left' ? this.leftResizer : this.rightResizer;
          resizer.classList.add('resizing');
          document.body.classList.add('pr-resizing');
          
          const startX = e.clientX;
          const startWidth = side === 'left' 
            ? this.leftPanel.offsetWidth 
            : this.rightPanel.offsetWidth;
          
          const onMouseMove = (e) => {
            const delta = side === 'left' ? e.clientX - startX : startX - e.clientX;
            const newWidth = startWidth + delta;
            
            const panel = side === 'left' ? this.leftPanel : this.rightPanel;
            const minWidth = parseInt(getComputedStyle(panel).minWidth);
            const maxWidth = parseInt(getComputedStyle(panel).maxWidth);
            
            if (newWidth >= minWidth && newWidth <= maxWidth) {
              const cssVar = side === 'left' ? '--panel-left-width' : '--panel-right-width';
              document.documentElement.style.setProperty(cssVar, `${newWidth}px`);
            }
          };
          
          const onMouseUp = () => {
            resizer.classList.remove('resizing');
            document.body.classList.remove('pr-resizing');
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
            this.saveWidths();
          };
          
          document.addEventListener('mousemove', onMouseMove);
          document.addEventListener('mouseup', onMouseUp);
        }
        
        resetWidth(side) {
          const defaultWidth = side === 'left' ? '280px' : '320px';
          const cssVar = side === 'left' ? '--panel-left-width' : '--panel-right-width';
          document.documentElement.style.setProperty(cssVar, defaultWidth);
          this.saveWidths();
        }
        
        saveWidths() {
          const leftWidth = getComputedStyle(document.documentElement)
            .getPropertyValue('--panel-left-width').trim() || '280px';
          const rightWidth = getComputedStyle(document.documentElement)
            .getPropertyValue('--panel-right-width').trim() || '320px';
          
          localStorage.setItem('pr_panel_widths', JSON.stringify({
            left: leftWidth,
            right: rightWidth
          }));
        }
        
        loadSavedWidths() {
          try {
            const saved = localStorage.getItem('pr_panel_widths');
            if (saved) {
              const { left, right } = JSON.parse(saved);
              if (left) document.documentElement.style.setProperty('--panel-left-width', left);
              if (right) document.documentElement.style.setProperty('--panel-right-width', right);
            }
          } catch (e) {
            // Ignore errors
          }
        }
      }

      // Initialize panel resizer
      const panelResizer = new PanelResizer();

      // Sync content type between mobile and desktop dropdowns
      const contentTypeMobile = document.getElementById('pr-content-type-mobile');
      const contentTypeDesktop = document.getElementById('pr-content-type');

      if (contentTypeMobile && contentTypeDesktop) {
        contentTypeMobile.addEventListener('change', () => {
          contentTypeDesktop.value = contentTypeMobile.value;
          pr.updateGenerateButton();
        });
        
        contentTypeDesktop.addEventListener('change', () => {
          contentTypeMobile.value = contentTypeDesktop.value;
        });
      }

      // Generate button in left panel
      const generateBtnMobile = document.getElementById('pr-generate-btn-mobile');
      if (generateBtnMobile) {
        generateBtnMobile.addEventListener('click', () => pr.generateContent());
      }

      // Suggestions delegation
      const suggestionsContainer = document.getElementById('pr-suggestions');

      // Clear drafts button
      const clearDraftsBtn = document.getElementById('pr-clear-drafts-btn');
      if (clearDraftsBtn) {
        clearDraftsBtn.addEventListener('click', async () => {
          const confirmed = await pr.showConfirm(
            'Keep only the latest draft and remove all previous versions?',
            'Clear Old Drafts'
          );
          if (confirmed) {
            await pr.clearOldDrafts();
          }
        });
      }

      // Suggestion buttons - one-click refinement
      if (suggestionsContainer) {
        suggestionsContainer.addEventListener('click', async (e) => {
          const btn = e.target.closest('.pr-suggestion-btn');
          if (btn) {
            const suggestion = btn.dataset.suggestion;
            await pr.applySuggestion(suggestion);
          }
        });
      }

      // Get generated element once
      const generatedEl = document.getElementById('pr-workspace-generated');

      // Show generated content actions when content exists
      const observer = new MutationObserver(() => {
        const actions = document.getElementById('pr-workspace-actions');
        if (generatedEl && actions) {
          actions.style.display = generatedEl.style.display === 'none' ? 'none' : 'flex';
        }
      });
      if (generatedEl) {
        observer.observe(generatedEl, { attributes: true, attributeFilter: ['style'] });
      }

      // Dropdown menu
      const menuBtn = document.getElementById('menu-btn');
      const dropdownMenu = document.getElementById('dropdown-menu');
      if (menuBtn && dropdownMenu) {
        menuBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          dropdownMenu.classList.toggle('active');
        });
        document.addEventListener('click', () => dropdownMenu.classList.remove('active'));
        dropdownMenu.addEventListener('click', (e) => e.stopPropagation());
      }

      // Settings modal (read-only, keys are managed on dashboard)
      const settingsModal = document.getElementById('settings-modal');
      const settingsClose = document.getElementById('settings-modal-close');
      const settingsCancel = document.getElementById('settings-cancel');

      async function openSettings() {
        const anthropicBadge = document.getElementById('pr-anthropic-status');
        const openaiBadge = document.getElementById('pr-openai-status');
        try {
          const response = await fetch('/api/settings');
          if (response.ok) {
            const serverSettings = await response.json();
            if (anthropicBadge) {
              anthropicBadge.textContent = serverSettings.hasAnthropicKey ? 'Connected' : 'Not set';
              anthropicBadge.classList.toggle('connected', !!serverSettings.hasAnthropicKey);
            }
            if (openaiBadge) {
              openaiBadge.textContent = serverSettings.hasOpenAIKey ? 'Connected' : 'Not set';
              openaiBadge.classList.toggle('connected', !!serverSettings.hasOpenAIKey);
            }
          }
        } catch {}
        settingsModal?.classList.add('visible');
      }

      document.getElementById('menu-settings')?.addEventListener('click', () => {
        dropdownMenu?.classList.remove('active');
        openSettings();
      });

      document.getElementById('nav-settings-btn')?.addEventListener('click', () => {
        openSettings();
      });

      settingsClose?.addEventListener('click', () => settingsModal?.classList.remove('visible'));
      settingsCancel?.addEventListener('click', () => settingsModal?.classList.remove('visible'));
      settingsModal?.addEventListener('click', (e) => {
        if (e.target === settingsModal) settingsModal.classList.remove('visible');
      });
    });

    // Stage Nav Rail Switching
    document.querySelectorAll('.pr-nav-item[data-stage]').forEach(tab => {
      tab.addEventListener('click', () => {
        const stage = tab.dataset.stage;
        
        // Update active nav item
        document.querySelectorAll('.pr-nav-item[data-stage]').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Show corresponding stage content, hide others
        document.querySelectorAll('.pr-stage-content').forEach(content => {
          if (content.dataset.stage === stage) {
            content.classList.add('active');
          } else {
            content.classList.remove('active');
          }
        });
        
        // Save active stage
        localStorage.setItem('pr_active_stage', stage);
      });
    });
    
    // Restore last active stage on page load
    document.addEventListener('DOMContentLoaded', () => {
      const savedStage = localStorage.getItem('pr_active_stage') || 'strategy';
      const savedTab = document.querySelector(`.pr-nav-item[data-stage="${savedStage}"]`);
      if (savedTab) {
        savedTab.click();
      }
    });
  </script>
</body>
</html>
