<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>PR - Glossi</title>
  <meta name="theme-color" content="#0a0d12">
  <link rel="icon" type="image/svg+xml" href="Asset 3.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Instrument+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="dashboard.css">
</head>
<body class="pr-page">
  <!-- Top Navigation -->
  <header class="top-nav">
    <div class="nav-left">
      <a href="index.html" class="nav-back" title="Back to Dashboard">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
      </a>
      <img src="Asset 3.svg" alt="Glossi" class="logo-img">
      <span class="nav-page-title">PR</span>
    </div>
    <div class="nav-right">
      <div class="dropdown-wrapper">
        <button class="btn-icon" id="menu-btn" title="Menu">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        <div class="dropdown-menu" id="dropdown-menu">
          <a href="index.html" class="dropdown-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            Dashboard
          </a>
          <a href="notebook.html" class="dropdown-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg>
            Notebook
          </a>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item" id="menu-settings">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
            </svg>
            Settings
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main PR Layout -->
  <main class="pr-main">
    <!-- Mobile Tab Bar -->
    <div class="pr-mobile-tabs" id="pr-mobile-tabs">
      <button class="pr-mobile-tab active" data-tab="sources">Sources</button>
      <button class="pr-mobile-tab" data-tab="workspace">Workspace</button>
      <button class="pr-mobile-tab" data-tab="strategy">Strategy</button>
    </div>

    <div class="pr-layout">
      <!-- Column 1: Sources -->
      <div class="pr-sources-panel" id="pr-sources-panel">
        <div class="pr-sources-header">
          <span class="pr-sources-label">Sources</span>
          <span class="pr-sources-count" id="pr-sources-count">0</span>
          <button class="pr-create-folder-btn" id="pr-create-folder-btn" title="Create Folder">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </button>
        </div>
        <div class="pr-source-search-wrap">
          <input type="text" class="pr-source-search" id="pr-source-search" placeholder="Search sources...">
        </div>
        <div class="pr-sources-list pr-drop-zone" id="pr-sources-list">
          <div class="pr-sources-empty" id="pr-sources-empty">
            <p>No sources yet</p>
            <p class="pr-empty-hint">Add content the PR agent can reference</p>
          </div>
        </div>
        <button class="pr-add-source-btn" id="pr-add-source-btn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          <span>Add Source</span>
        </button>

        <!-- History Section -->
        <div class="pr-history-divider"></div>
        <div class="pr-history-header" id="pr-history-toggle">
          <svg class="pr-history-chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
          <span>History</span>
        </div>
        <div id="pr-history-content">
          <div class="pr-history-list" id="pr-history-list">
            <div class="pr-history-empty" id="pr-history-empty">
              <p>No outputs yet</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Column 2: Workspace -->
      <div class="pr-workspace-panel" id="pr-workspace-panel">
        <!-- Top bar -->
        <div class="pr-workspace-topbar">
          <div class="pr-workspace-controls">
            <select class="pr-content-type" id="pr-content-type">
              <option value="press_release">Press Release</option>
              <option value="media_pitch">Media Pitch Email</option>
              <option value="product_announcement">Product Announcement</option>
              <option value="founder_quote">Founder Quote / Soundbite</option>
              <option value="blog_post">Blog Post</option>
              <option value="linkedin_post">LinkedIn Post</option>
              <option value="tweet_thread">Tweet Thread</option>
              <option value="briefing_doc">Briefing Document</option>
              <option value="talking_points">Talking Points</option>
              <option value="custom">Custom</option>
            </select>
            <button class="pr-generate-btn" id="pr-generate-btn" disabled>
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
              </svg>
              Generate
            </button>
            <button class="pr-regenerate-btn" id="pr-regenerate-btn" style="display:none">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 4v6h-6"></path>
                <path d="M1 20v-6h6"></path>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
              </svg>
              Regenerate
            </button>
          </div>
          <div class="pr-workspace-actions" style="display:none" id="pr-workspace-actions">
            <button class="pr-action-btn" id="pr-copy-btn" title="Copy to clipboard">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
            </button>
            <div class="pr-export-wrap">
              <button class="pr-action-btn" id="pr-export-btn" title="Export">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
              </button>
              <div class="pr-export-menu" id="pr-export-menu">
                <button class="pr-export-item" id="pr-export-text">Copy as text</button>
                <button class="pr-export-item" id="pr-export-html">Download as HTML</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Status hint (shown when generate is disabled) -->
        <div class="pr-status-hint" id="pr-status-hint" style="display:none">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <span id="pr-status-hint-text"></span>
        </div>

        <!-- Custom prompt (hidden unless Custom selected) -->
        <div class="pr-custom-prompt-wrap" id="pr-custom-prompt-wrap" style="display:none">
          <textarea class="pr-custom-prompt" id="pr-custom-prompt" placeholder="Describe what you want to generate..." rows="2"></textarea>
        </div>

        <!-- Content area -->
        <div class="pr-workspace-content" id="pr-workspace-content">
          <!-- Empty state -->
          <div class="pr-workspace-empty" id="pr-workspace-empty">
            <div class="pr-empty-icon">
              <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
              </svg>
            </div>
            <p class="pr-empty-title">PR Agent</p>
            <p class="pr-empty-desc">To get started:</p>
            <ol class="pr-empty-steps" id="pr-empty-steps">
              <li id="pr-step-key">Anthropic API key (set in Dashboard Settings)</li>
              <li id="pr-step-source">Add a source using the left panel</li>
              <li id="pr-step-select">Select a content type above, then click Generate</li>
            </ol>
          </div>

          <!-- Loading state -->
          <div class="pr-loading-state" id="pr-loading-state" style="display:none">
            <div class="pr-loading-spinner"></div>
            <p>Generating content...</p>
          </div>

          <!-- Generated content -->
          <div class="pr-workspace-generated" id="pr-workspace-generated" style="display:none">
            <div class="pr-generated-content" id="pr-generated-content"></div>
            <div class="pr-verification-bar" id="pr-verification-bar" style="display:none">
              <div class="pr-verification-info">
                <span class="pr-verification-text" id="pr-verification-text">0 of 0 claims sourced</span>
              </div>
              <div class="pr-verification-track">
                <div class="pr-verification-progress" id="pr-verification-progress"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Column 3: Strategy Panel -->
      <div class="pr-strategy-panel" id="pr-strategy-panel">
        <div class="pr-strategy-header">
          <span class="pr-strategy-label">Strategy</span>
        </div>
        <div class="pr-strategy-body">
          <div class="pr-strategy-content" id="pr-strategy-content"></div>
          <div class="pr-strategy-empty" id="pr-strategy-empty">
            <p>Generate content to see distribution strategy, timing recommendations, and amplification playbook.</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Add Source Modal -->
  <div class="modal-overlay" id="pr-source-modal">
    <div class="modal modal-large">
      <div class="modal-header">
        <h2>Add Source</h2>
        <button class="btn-icon modal-close" id="pr-source-modal-close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <!-- Source Type Tabs -->
        <div class="pr-source-tabs">
          <button class="pr-source-tab active" data-type="text">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
            </svg>
            Paste Text
          </button>
          <button class="pr-source-tab" data-type="url">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
            URL
          </button>
          <button class="pr-source-tab" data-type="file">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
              <polyline points="13 2 13 9 20 9"></polyline>
            </svg>
            Upload File
          </button>
          <button class="pr-source-tab" data-type="audio">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
              <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
              <line x1="12" y1="19" x2="12" y2="23"></line>
            </svg>
            Audio
          </button>
        </div>

        <!-- Paste Text Panel -->
        <div class="pr-source-panel active" id="pr-panel-text">
          <div class="notes-input-section">
            <label for="pr-source-title">Title (optional)</label>
            <input type="text" id="pr-source-title" class="input" placeholder="e.g., Q1 Product Update">
          </div>
          <div class="notes-input-section">
            <label for="pr-source-text">Content</label>
            <textarea id="pr-source-text" class="input textarea" rows="10" placeholder="Paste your text content here..."></textarea>
          </div>
        </div>

        <!-- URL Panel -->
        <div class="pr-source-panel" id="pr-panel-url">
          <div class="notes-input-section">
            <label for="pr-source-title-url">Title (optional)</label>
            <input type="text" id="pr-source-title-url" class="input" placeholder="e.g., TechCrunch Article">
          </div>
          <div class="notes-input-section">
            <label for="pr-source-url">URL</label>
            <input type="url" id="pr-source-url" class="input" placeholder="https://...">
            <p class="input-hint">Content will be fetched and extracted automatically</p>
          </div>
        </div>

        <!-- File Upload Panel -->
        <div class="pr-source-panel" id="pr-panel-file">
          <div class="notes-input-section">
            <label for="pr-source-title-file">Title (optional)</label>
            <input type="text" id="pr-source-title-file" class="input" placeholder="e.g., Press Kit PDF">
          </div>
          <div class="pr-file-dropzone" id="pr-file-dropzone">
            <input type="file" id="pr-source-file-input" accept=".txt,.md,.csv,.pdf" style="display:none">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <span>Drop file here or click to browse</span>
            <span class="pr-dropzone-hint">PDF, TXT, MD, CSV (max 10MB)</span>
          </div>
          <div class="pr-file-preview" id="pr-file-preview" style="display:none"></div>
        </div>

        <!-- Audio Panel -->
        <div class="pr-source-panel" id="pr-panel-audio">
          <div class="notes-input-section">
            <label for="pr-source-title-audio">Title (optional)</label>
            <input type="text" id="pr-source-title-audio" class="input" placeholder="e.g., Founder Interview">
          </div>
          <div class="pr-audio-controls">
            <button class="btn btn-secondary" id="pr-audio-record">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="6" fill="currentColor"></circle>
              </svg>
              Record
            </button>
            <button class="btn btn-danger" id="pr-audio-stop" style="display:none">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="6" y="6" width="12" height="12" fill="currentColor"></rect>
              </svg>
              Stop
            </button>
            <span class="pr-audio-divider">or</span>
            <button class="btn btn-secondary" id="pr-audio-upload-btn">Upload Audio</button>
            <input type="file" id="pr-audio-file-input" accept=".mp3,.wav,.m4a,.webm" style="display:none">
          </div>
          <div class="pr-audio-indicator" id="pr-audio-indicator" style="display:none">
            <span class="pr-recording-dot"></span>
            <span>Recording...</span>
          </div>
          <div class="pr-audio-preview" id="pr-audio-preview" style="display:none">
            <span id="pr-audio-status">Processing...</span>
          </div>
          <div class="pr-audio-transcript" id="pr-audio-transcript" style="display:none"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="pr-source-cancel">Cancel</button>
        <button class="btn btn-primary" id="pr-source-save">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Add Source
        </button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settings-modal">
    <div class="modal">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="btn-icon modal-close" id="settings-modal-close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="settings-section">
          <h3>AI Configuration</h3>
          <p class="input-hint" style="margin-bottom: var(--space-3)">API keys are shared across all Glossi pages. Configure them on the <a href="index.html" style="color: var(--accent-green)">Dashboard</a>.</p>
          <div class="pr-settings-status">
            <div class="pr-settings-row">
              <span class="pr-settings-label-text">Anthropic API Key</span>
              <span class="pr-settings-badge" id="pr-anthropic-status">Not set</span>
            </div>
            <div class="pr-settings-row">
              <span class="pr-settings-label-text">OpenAI API Key</span>
              <span class="pr-settings-badge" id="pr-openai-status">Not set</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <a href="index.html" class="btn btn-primary">Open Dashboard Settings</a>
        <button class="btn btn-secondary" id="settings-cancel">Close</button>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal-overlay" id="confirm-modal">
    <div class="modal modal-confirm">
      <div class="modal-header">
        <h2 id="confirm-modal-title">Confirm</h2>
      </div>
      <div class="modal-body">
        <p id="confirm-modal-message">Are you sure?</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="confirm-modal-cancel">Cancel</button>
        <button class="btn btn-danger" id="confirm-modal-ok">OK</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container"></div>

  <!-- PDF.js for file processing -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
  </script>

  <script type="module">
    import { PRAgent } from './modules/pr.js';

    document.addEventListener('DOMContentLoaded', () => {
      const pr = new PRAgent();
      pr.init();
      pr.setupFileUpload();
      pr.setupAudio();

      // Mobile tab switching
      document.querySelectorAll('.pr-mobile-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.pr-mobile-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          const target = tab.dataset.tab;
          document.getElementById('pr-sources-panel').classList.toggle('mobile-active', target === 'sources');
          document.getElementById('pr-workspace-panel').classList.toggle('mobile-active', target === 'workspace');
          document.getElementById('pr-strategy-panel').classList.toggle('mobile-active', target === 'strategy');
        });
      });

      // Show generated content actions when content exists
      const observer = new MutationObserver(() => {
        const generated = document.getElementById('pr-workspace-generated');
        const actions = document.getElementById('pr-workspace-actions');
        if (generated && actions) {
          actions.style.display = generated.style.display === 'none' ? 'none' : 'flex';
        }
      });
      const generated = document.getElementById('pr-workspace-generated');
      if (generated) {
        observer.observe(generated, { attributes: true, attributeFilter: ['style'] });
      }

      // Dropdown menu
      const menuBtn = document.getElementById('menu-btn');
      const dropdownMenu = document.getElementById('dropdown-menu');
      if (menuBtn && dropdownMenu) {
        menuBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          dropdownMenu.classList.toggle('active');
        });
        document.addEventListener('click', () => dropdownMenu.classList.remove('active'));
        dropdownMenu.addEventListener('click', (e) => e.stopPropagation());
      }

      // Settings modal (read-only, keys are managed on dashboard)
      const settingsModal = document.getElementById('settings-modal');
      const settingsClose = document.getElementById('settings-modal-close');
      const settingsCancel = document.getElementById('settings-cancel');

      function openSettings() {
        const anthropicBadge = document.getElementById('pr-anthropic-status');
        const openaiBadge = document.getElementById('pr-openai-status');
        try {
          const settings = JSON.parse(localStorage.getItem('glossi_settings') || '{}');
          if (anthropicBadge) {
            const hasKey = settings.apiKey && settings.apiKey.length > 0;
            anthropicBadge.textContent = hasKey ? 'Connected' : 'Not set';
            anthropicBadge.classList.toggle('connected', hasKey);
          }
          if (openaiBadge) {
            const hasKey = settings.openaiApiKey && settings.openaiApiKey.length > 0;
            openaiBadge.textContent = hasKey ? 'Connected' : 'Not set';
            openaiBadge.classList.toggle('connected', hasKey);
          }
        } catch {}
        settingsModal?.classList.add('visible');
      }

      document.getElementById('menu-settings')?.addEventListener('click', () => {
        dropdownMenu?.classList.remove('active');
        openSettings();
      });

      settingsClose?.addEventListener('click', () => settingsModal?.classList.remove('visible'));
      settingsCancel?.addEventListener('click', () => settingsModal?.classList.remove('visible'));
      settingsModal?.addEventListener('click', (e) => {
        if (e.target === settingsModal) settingsModal.classList.remove('visible');
      });
    });
  </script>
</body>
</html>
